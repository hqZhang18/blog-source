---
title: JavaScript 垃圾回收和内存管理
date: 2017-01-05 21:49:03
categories: 
  - 技术
  - JavaScript
tags: JavaScript
---
JavaScript 具有自动垃圾收集机制（GC：Garbage Collecation），也就是说，执行环境会负责管理代码执行过程中使用的内存。而在 C 和 C++ 之类的语言中，开发人员的一项基本任务就是手工跟踪内存的使用情况，这是造成许多问题的一个根源。
<!--more-->
<p></p>
在编写 JavaScript 程序时，开发人员不用再关心内存使用问题，所需内存的分配以及无用内存的回收完全实现了自动管理。这种垃圾收集机制的原理其实很简单：找出那些不再继续使用的变量，然后释放其占用的内存。为此，垃圾收集器会按照固定的时间间隔（或代码执行中预定的收集时间），周期性地执行这一操作。
<p></p>
正因为垃圾回收器的存在，许多人认为 JavaScript 不用太关心内存管理的问题，但如果不了解 JavaScript 的内存管理机制，我们同样非常容易成内存泄漏（内存无法被回收）的情况。

#### 垃圾回收机制
##### 内存的分配场景
```javascript
// 1.对象
new Object(); 
new MyConstructor(); 
{ a: 4, b: 5 } 
Object.create();

// 2.数组 
new Array(); 
[ 1, 2, 3, 4 ];

// 3.字符串，JavaScript 的字符串和 .NET 一样，使用资源池和 copy on write 方式管理字符串。
new String("hello hyddd"); 
"<p>" + e.innerHTML + "</p>"

// 4.函数
var x = function () { ... } 
new Function(code);

// 5.闭包 
function outer(name) {
     var x = name; 
     return function inner() { 
        return "Hi, " + name; 
     } 
 }
```

##### 内存的生命周期

下面我们来分析一下函数中局部变量的正常生命周期。

* 内存分配：局部变量只在函数执行的过程中存在。而在这个过程中，会为局部变量在栈（或堆）内存上分配相应的空间，以便存储它们的值。
* 内存使用：然后在函数中使用这些变量，直至函数执行结束。
* 内存回收：此时，局部变量就没有存在的必要了，因此可以释放它们的内存以供将来使用。
通常，很容易判断变量是否还有存在的必要，但并非所有情况下都这么容易就能得出结论（例如：使用闭包的时）。垃圾收集器必须跟踪哪个变量有用哪个变量没用，对于不再有用的变量打上标记，以备将来收回其占用的内存。用于标识无用变量的策略可能会因实现而异，但具体到浏览器中的实现，则通常有两个策略：标记清除 和 引用计数。